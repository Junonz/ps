(function(){var AddressHierarchy,KeepMePosted,SupplyChecker,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function s(){this.constructor=e}for(var r in t)__hasProp.call(t,r)&&(e[r]=t[r]);return s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype,e};AddressHierarchy=function(){function e(){this.populateSuburbs=__bind(this.populateSuburbs,this),this.populateDistricts=__bind(this.populateDistricts,this),this.populateRegions=__bind(this.populateRegions,this),this.areas=window.jsonstring,this.populate()}return e.prototype.populate=function(){return this.populateRegions(),this.form.find("select[name='address[region]']").change(this.populateDistricts),this.form.find("select[name='address[district]']").change(this.populateSuburbs)},e.prototype.populateRegions=function(){var e,t,s,r,o;for(t=this.form.find("select[name='address[region]']").empty(),$("<option>Select a Region</option>").appendTo(t),o=this.areas.regions,s=0,r=o.length;s<r;s++)e=o[s],$("<option />").html(e).appendTo(t);return this.populateDistricts()},e.prototype.populateDistricts=function(){var e,t,s,r,o,i;if(t=this.form.find("select[name='address[region]']").val(),s=this.form.find("select[name='address[district]']").empty(),$("<option>Select a District</option>").appendTo(s),this.areas.districts[t])for(s.removeAttr("disabled"),i=this.areas.districts[t],r=0,o=i.length;r<o;r++)e=i[r],$("<option />").html(e).appendTo(s);else s.attr("disabled",!0);return this.populateSuburbs()},e.prototype.populateSuburbs=function(){var e,t,s,r,o,i,n,p;if(s=this.form.find("select[name='address[region]']").val(),t=this.form.find("select[name='address[district]']").val(),r=this.form.find("select[name='address[suburb]']").empty(),$("<option>Select a Suburb</option>").appendTo(r),this.areas.suburbs[s]&&this.areas.suburbs[s][t]){for(r.removeAttr("disabled"),n=this.areas.suburbs[s][t],p=[],o=0,i=n.length;o<i;o++)e=n[o],p.push($("<option />").html(e).appendTo(r));return p}return r.attr("disabled",!0)},e}(),KeepMePosted=function(_super){function KeepMePosted(){this.onSubmit=__bind(this.onSubmit,this);var e,t,s,r,o;if(this.form=$("#keep-me-posted-content").submit(this.onSubmit),KeepMePosted.__super__.constructor.call(this),"undefined"!=typeof localStorage&&null!==localStorage)for((t=localStorage["cached-address-address[region]"])&&(this.form.find("select[name='address[region]']").val(t).removeAttr("disabled"),this.populateDistricts()),(t=localStorage["cached-address-address[district]"])&&(this.form.find("select[name='address[district]']").val(t).removeAttr("disabled"),this.populateSuburbs()),o="region district suburb address1 address2 address3".split(/\s/),s=0,r=o.length;s<r;s++)e=o[s],(t=localStorage["cached-address-address["+e+"]"])&&(this.form.find("*[name='address["+e+"]']").val(t).removeAttr("disabled"),delete localStorage["cached-address-address["+e+"]"])}return __extends(KeepMePosted,_super),KeepMePosted.prototype.submit=function(){return this.form.submit()},KeepMePosted.prototype.onSubmit=function(e){var _this=this;return $.ajax({url:"/supply_check_v2/keep_me_posted",type:"POST",dataType:"text",data:this.form.serialize()+"&referrer="+escape(window.location),statusCode:{422:function(e){var t,s,r,o,i;for($("#keep-posted-error div").html(""),i=$.parseJSON(e.responseText).errors,r=0,o=i.length;r<o;r++)t=i[r],s=$("<span>Oops! "+t+"</span>"),$("#keep-posted-error div").append(s);return $("#keep-posted-error").show()}},success:function(response){var Element;return Element={update:function(e,t){return $("#"+e).html(t).show()}},response.match(/keep-posted-error/)?eval(response):($("#keep_me_posted_enter_details").hide(),$("#keep_me_posted_success").show())}}),e.preventDefault()},KeepMePosted}(AddressHierarchy),SupplyChecker=function(e){function t(){this.onSupplyCheck=__bind(this.onSupplyCheck,this),this.submit=__bind(this.submit,this),this.onSubmit=__bind(this.onSubmit,this),this.form=$("#supply_check_address_region").parents("form").submit(this.onSubmit),t.__super__.constructor.call(this)}return __extends(t,e),t.prototype.onSubmit=function(e){return this.submit(),e.preventDefault()},t.prototype.showForm=function(){return $("#enter_details").show(),$("#supply_check_responses > div").hide(),!1},t.prototype.submit=function(){var e,t,s,r,o;if($("#supply_check_responses > div").hide(),"undefined"!=typeof localStorage&&null!==localStorage)for(o=this.form.find("input,select"),s=0,r=o.length;s<r;s++)t=o[s],localStorage["cached-address-"+$(t).attr("name")]=$(t).val();return e=this.form.serialize(),e+="&address%5Baddress3%5D=Dummy+street",e+="&address%5Baddress2%5D=123",$.ajax({url:"/supply_check_v2/supply_check",data:e,type:"POST",success:this.onSupplyCheck}),!1},t.prototype.onSupplyCheck=function(e){var t,s,r,o,i=this;s=$("#supply_check_errors div").empty().hide(),o=e.errors;for(t in o)r=o[t],$("<span>"+r+"</span>").appendTo(s),s.show();if(null!==e.status&&$("#enter_details").hide(),$("#supply_check_responses > div").hide().filter("#"+e.status).show(),"waiting_for_icp_details"===e.status)return setTimeout(function(){return $.ajax({url:"/supply_check_v2/waiting_for_icp_details",type:"POST",success:i.onSupplyCheck,data:{id:e.supply_check_request_id,count:e.count+1}})},3e3)},t}(AddressHierarchy),$(document).ready(function(){return window.keepMePosted=new KeepMePosted,window.supplyChecker=new SupplyChecker})}).call(this);